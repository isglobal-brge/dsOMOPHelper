<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chronic Obstructive Pulmonary Disease (COPD) Analysis using dsOMOP • dsOMOPHelper</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chronic Obstructive Pulmonary Disease (COPD) Analysis using dsOMOP">
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dsOMOPHelper</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/01_demo.html">Demonstration</a></li>
    <li><a class="dropdown-item" href="../articles/02_copd.html">Chronic Obstructive Pulmonary Disease (COPD) Analysis using dsOMOP</a></li>
    <li><a class="dropdown-item" href="../articles/03_template.html">Basic GLM with booleans template</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chronic Obstructive Pulmonary Disease (COPD) Analysis using dsOMOP</h1>
            
      

      <div class="d-none name"><code>02_copd.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>For this reproducibility analysis, we utilized the <strong>Tufts
Synthetic Dataset</strong>, which consists of fully synthetic electronic
health record (EHR) data representing 567,000 synthetic patients. This
dataset was generated in 2021 through a collaboration between
<strong>Syntegra, Inc.</strong> and <strong>Tufts Medical
Center</strong>, using a deep learning transformer model. The model was
trained on real-world EHR data from the <strong>Tufts Research Data
Warehouse (TRDW)</strong>, which includes longitudinal clinical data
from patients who received care at Tufts Medical Center. The Tufts
Synthetic Dataset contains clinical information such as patient visits,
conditions, medications, laboratory measurements, procedures,
observations, and device exposures, all structured according to the OMOP
Common Data Model (CDM) version 5.3.</p>
<p>In this analysis, we focused on identifying key predictors for
chronic obstructive pulmonary disease (COPD) based on their relevance in
the literature and their availability and representation in our dataset,
ensuring a sufficient patient population to obtain statistically
meaningful results. These variables have well-established associations
with COPD:</p>
<ul>
<li>Tobacco use</li>
<li>Vitamin D deficiency</li>
<li>History of asthma</li>
<li>History of rheumatoid arthritis</li>
</ul>
</div>
<div class="section level2">
<h2 id="server-connection">Server connection<a class="anchor" aria-label="anchor" href="#server-connection"></a>
</h2>
<p>We start by establishing a connection with ISGlobal’s BRGE
development Opal server. This Opal server is configured to allow access
to a resource with the Tufts Synthetic Dataset:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datashield/DSI/" class="external-link">DSI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datashield/DSOpal/" class="external-link">DSOpal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">dsBaseClient</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">dsOMOPClient</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">dsOMOPHelper</span><span class="op">)</span></span>
<span></span>
<span><span class="va">builder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://datashield.github.io/DSI/reference/newDSLoginBuilder.html" class="external-link">newDSLoginBuilder</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server<span class="op">=</span><span class="st">"server1"</span>, </span>
<span>               url<span class="op">=</span><span class="st">"https://opal.isglobal.org/brge"</span>,</span>
<span>               user<span class="op">=</span><span class="st">"administrator"</span>, </span>
<span>               password<span class="op">=</span><span class="st">"password"</span>, </span>
<span>               driver <span class="op">=</span> <span class="st">"OpalDriver"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">logindata</span> <span class="op">&lt;-</span> <span class="va">builder</span><span class="op">$</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">conns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.login.html" class="external-link">datashield.login</a></span><span class="op">(</span>logins<span class="op">=</span><span class="va">logindata</span><span class="op">)</span></span></code></pre></div>
<p>Then we create an instance of <code>dsOMOPHelper</code> to interact
with the database and build our desired dataset:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.omop.helper.html">ds.omop.helper</a></span><span class="op">(</span></span>
<span>    connections <span class="op">=</span> <span class="va">conns</span>,</span>
<span>    resource <span class="op">=</span> <span class="st">"omop_demo.tufts"</span>, </span>
<span>    symbol <span class="op">=</span> <span class="st">"tufts"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dataset-construction">Dataset construction<a class="anchor" aria-label="anchor" href="#dataset-construction"></a>
</h2>
<div class="section level3">
<h3 id="variable-definition">Variable definition<a class="anchor" aria-label="anchor" href="#variable-definition"></a>
</h3>
<p>We will define the variables that will be present in our dataset.
These variables include our outcome variable and the predictor variables
we’ll use in our generalized linear model (GLM) for COPD:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Outcome variable</span></span>
<span><span class="va">outcome_concept_id</span> <span class="op">&lt;-</span> <span class="fl">255573</span> <span class="co"># Chronic Obstructive Pulmonary Disease (COPD)</span></span>
<span></span>
<span><span class="co"># Predictor variables</span></span>
<span><span class="va">observation_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">4005823</span> <span class="co"># Tobacco use</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">condition_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">317009</span>, <span class="co"># History of asthma</span></span>
<span>    <span class="fl">436070</span>, <span class="co"># Rheumatoid arthritis</span></span>
<span>    <span class="fl">80809</span>   <span class="co"># Vitamin D deficiency</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We check the structure of the resulting table to ensure it is correctly loaded</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"tufts"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $server1</span></span>
<span><span class="co">## $server1$class</span></span>
<span><span class="co">## [1] "data.frame"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $server1$`number of rows`</span></span>
<span><span class="co">## [1] 576750</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $server1$`number of columns`</span></span>
<span><span class="co">## [1] 11</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $server1$`variables held`</span></span>
<span><span class="co">##  [1] "person_id"            "gender_concept_id"    "year_of_birth"       </span></span>
<span><span class="co">##  [4] "month_of_birth"       "day_of_birth"         "birth_datetime"      </span></span>
<span><span class="co">##  [7] "race_concept_id"      "ethnicity_concept_id" "location_id"         </span></span>
<span><span class="co">## [10] "provider_id"          "care_site_id"</span></span></code></pre>
<p>Based on the structure of this script, we can easily change the
concept IDs of the variables and re-run this script to analyze different
conditions or predictors.</p>
</div>
<div class="section level3">
<h3 id="data-retrieval">Data retrieval<a class="anchor" aria-label="anchor" href="#data-retrieval"></a>
</h3>
<p>We use <code>dsOMOPHelper</code>’s <code>auto</code> function to
retrieve the defined variables:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">auto</span><span class="op">(</span></span>
<span>    table <span class="op">=</span> <span class="st">"condition_occurrence"</span>, </span>
<span>    concepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">outcome_concept_id</span>, <span class="va">condition_list</span><span class="op">)</span>,</span>
<span>    columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"condition_occurrence_id"</span><span class="op">)</span> </span>
<span>    <span class="co"># We only want the condition occurrence ID to act as a boolean indicating </span></span>
<span>    <span class="co"># the presence of the condition occurrence</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">o</span><span class="op">$</span><span class="fu">auto</span><span class="op">(</span></span>
<span>    table <span class="op">=</span> <span class="st">"observation"</span>, </span>
<span>    concepts <span class="op">=</span> <span class="va">observation_list</span>,</span>
<span>    columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"observation_id"</span><span class="op">)</span></span>
<span>    <span class="co"># We only want the observation ID to act as a boolean indicating </span></span>
<span>    <span class="co"># the presence of the observation</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="concept-name-matching">Concept name matching<a class="anchor" aria-label="anchor" href="#concept-name-matching"></a>
</h3>
<p>We need to identify the format of the concept names as they will be
added to the dataset. This allows us to automate the process of
identifying exact variable names based on the retrieved concept names
from the database, which facilitates automation without having to
manually change the variable names in the script.</p>
<p>The function <code>custom_make_names</code> is used to format the
concept names as they would be in the dataset:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_make_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html" class="external-link">make.names</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span>
<span>  <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span>
<span>  <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\."</span>, <span class="st">"_"</span>, <span class="va">name</span><span class="op">)</span></span>
<span>  <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_+"</span>, <span class="st">"_"</span>, <span class="va">name</span><span class="op">)</span></span>
<span>  <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^_|_$"</span>, <span class="st">""</span>, <span class="va">name</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we can retrieve the concept lists from the database and match
them to the names as we expect them to be in the dataset:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve the concept catalogs for condition occurrence and observation</span></span>
<span><span class="va">all_concepts_condition</span> <span class="op">&lt;-</span> <span class="va">o</span><span class="op">$</span><span class="fu">concepts</span><span class="op">(</span><span class="st">"condition_occurrence"</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">integer.max</span><span class="op">)</span><span class="op">$</span><span class="va">server1</span></span>
<span><span class="va">all_concepts_observation</span> <span class="op">&lt;-</span> <span class="va">o</span><span class="op">$</span><span class="fu">concepts</span><span class="op">(</span><span class="st">"observation"</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">integer.max</span><span class="op">)</span><span class="op">$</span><span class="va">server1</span></span>
<span></span>
<span><span class="co"># Match the concept IDs to the concept catalogs</span></span>
<span><span class="va">matched_concept_condition</span> <span class="op">&lt;-</span> <span class="va">all_concepts_condition</span><span class="op">[</span><span class="va">all_concepts_condition</span><span class="op">$</span><span class="va">concept_id</span> <span class="op">==</span> <span class="va">outcome_concept_id</span>, <span class="op">]</span></span>
<span><span class="va">matched_concepts_conditions</span> <span class="op">&lt;-</span> <span class="va">all_concepts_condition</span><span class="op">[</span><span class="va">all_concepts_condition</span><span class="op">$</span><span class="va">concept_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">condition_list</span>, <span class="op">]</span></span>
<span><span class="va">matched_concepts_observation</span> <span class="op">&lt;-</span> <span class="va">all_concepts_observation</span><span class="op">[</span><span class="va">all_concepts_observation</span><span class="op">$</span><span class="va">concept_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">observation_list</span>, <span class="op">]</span></span></code></pre></div>
<p>These will be used to automatically match the variable names in the
dataset in the next step.</p>
</div>
<div class="section level3">
<h3 id="data-type-conversions">Data type conversions<a class="anchor" aria-label="anchor" href="#data-type-conversions"></a>
</h3>
<p>DataSHIELD will not transform an ID to a boolean if it is in a string
format, so this process involves two steps: 1. Transforming the ID to
numeric 2. Transforming the numeric ID to boolean</p>
<p>we have defined a function to do this automatically for every
variable:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">convert_to_numeric_and_boolean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">variable_name</span>, <span class="va">id_type</span>, <span class="va">conns</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Construct the full variable name in the format "tufts$variable_name.id_type"</span></span>
<span>  <span class="va">full_variable_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"tufts$"</span>, <span class="va">variable_name</span>, <span class="st">"."</span>, <span class="va">id_type</span><span class="op">)</span></span>
<span>  <span class="co"># Create a new variable name for the numeric conversion</span></span>
<span>  <span class="va">new_numeric_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">variable_name</span>, <span class="st">"_numeric"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Convert the original variable to numeric</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.asNumeric.html" class="external-link">ds.asNumeric</a></span><span class="op">(</span></span>
<span>    x.name <span class="op">=</span> <span class="va">full_variable_name</span>, </span>
<span>    newobj <span class="op">=</span> <span class="va">new_numeric_name</span>, </span>
<span>    datasources <span class="op">=</span> <span class="va">conns</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Convert the numeric variable to boolean</span></span>
<span>  <span class="co"># True (1) if not equal to 0, False (0) otherwise</span></span>
<span>  <span class="co"># NA values are assigned 0</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.Boole.html" class="external-link">ds.Boole</a></span><span class="op">(</span></span>
<span>    V1 <span class="op">=</span> <span class="va">new_numeric_name</span>, </span>
<span>    V2 <span class="op">=</span> <span class="fl">0</span>, </span>
<span>    Boolean.operator <span class="op">=</span> <span class="st">"!="</span>, </span>
<span>    numeric.output <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>    na.assign <span class="op">=</span> <span class="fl">0</span>, </span>
<span>    newobj <span class="op">=</span> <span class="va">variable_name</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we can apply this function to the selected variables:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the name of the outcome variable as it will be in the dataset</span></span>
<span><span class="va">outcome_variable</span> <span class="op">&lt;-</span> <span class="fu">custom_make_names</span><span class="op">(</span><span class="va">matched_concept_condition</span><span class="op">$</span><span class="va">concept_name</span><span class="op">)</span></span>
<span><span class="co"># Perform the type conversion of the outcome variable to numeric and then to boolean</span></span>
<span><span class="fu">convert_to_numeric_and_boolean</span><span class="op">(</span><span class="va">outcome_variable</span>, <span class="st">"condition_occurrence_id"</span>, <span class="va">conns</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $is.object.created</span></span>
<span><span class="co">## [1] "A data object &lt;chronic_obstructive_pulmonary_disease&gt; has been created in all specified data sources"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $validity.check</span></span>
<span><span class="co">## [1] "&lt;chronic_obstructive_pulmonary_disease&gt; appears valid in all sources"</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Loop through every recognized condition occurrence concept</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">concept</span> <span class="kw">in</span> <span class="va">matched_concepts_conditions</span><span class="op">$</span><span class="va">concept_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Get the exact name of the condition occurrence as it will be in the dataset</span></span>
<span>  <span class="va">variable_name</span> <span class="op">&lt;-</span> <span class="fu">custom_make_names</span><span class="op">(</span><span class="va">concept</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Perform the type conversion of the condition occurrence to numeric and then to boolean</span></span>
<span>  <span class="fu">convert_to_numeric_and_boolean</span><span class="op">(</span><span class="va">variable_name</span>, <span class="st">"condition_occurrence_id"</span>, <span class="va">conns</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Loop through every recognized observation concept</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">concept</span> <span class="kw">in</span> <span class="va">matched_concepts_observation</span><span class="op">$</span><span class="va">concept_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Get the exact name of the observation as it will be in the dataset</span></span>
<span>  <span class="va">variable_name</span> <span class="op">&lt;-</span> <span class="fu">custom_make_names</span><span class="op">(</span><span class="va">concept</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Perform the type conversion of the observation to numeric and then to boolean</span></span>
<span>  <span class="fu">convert_to_numeric_and_boolean</span><span class="op">(</span><span class="va">variable_name</span>, <span class="st">"observation_id"</span>, <span class="va">conns</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-table-for-the-glm">Create table for the GLM<a class="anchor" aria-label="anchor" href="#create-table-for-the-glm"></a>
</h3>
<p>We create a new table with the prepared outcome and predictors for
the GLM:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the exact name of the variables as they will be in the dataset</span></span>
<span><span class="va">variable_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">matched_concepts_observation</span><span class="op">$</span><span class="va">concept_name</span>, <span class="va">custom_make_names</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">matched_concepts_conditions</span><span class="op">$</span><span class="va">concept_name</span>, <span class="va">custom_make_names</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">custom_make_names</span><span class="op">(</span><span class="va">outcome_variable</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a new table with the prepared outcome and predictors</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.cbind.html" class="external-link">ds.cbind</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">variable_names</span>,</span>
<span>  DataSHIELD.checks <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  newobj <span class="op">=</span> <span class="st">"glm_table"</span>,</span>
<span>  datasources <span class="op">=</span> <span class="va">conns</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $is.object.created</span></span>
<span><span class="co">## [1] "A data object &lt;glm_table&gt; has been created in all specified data sources"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $validity.check</span></span>
<span><span class="co">## [1] "&lt;glm_table&gt; appears valid in all sources"</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We check the structure of the resulting table to ensure it has been created correctly</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"glm_table"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $server1</span></span>
<span><span class="co">## $server1$class</span></span>
<span><span class="co">## [1] "data.frame"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $server1$`number of rows`</span></span>
<span><span class="co">## [1] 576750</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $server1$`number of columns`</span></span>
<span><span class="co">## [1] 5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $server1$`variables held`</span></span>
<span><span class="co">## [1] "tobacco_user"                         </span></span>
<span><span class="co">## [2] "rheumatoid_arthritis"                 </span></span>
<span><span class="co">## [3] "asthma"                               </span></span>
<span><span class="co">## [4] "vitamin_d_deficiency"                 </span></span>
<span><span class="co">## [5] "chronic_obstructive_pulmonary_disease"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="generalized-linear-model">Generalized Linear Model<a class="anchor" aria-label="anchor" href="#generalized-linear-model"></a>
</h2>
<p>Now, we can finally execute the final step - running the GLM on our
prepared dataset:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the formula for the GLM</span></span>
<span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"glm_table$"</span>, <span class="va">outcome_variable</span>, <span class="st">" ~ "</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"glm_table$"</span>, <span class="fu">custom_make_names</span><span class="op">(</span><span class="va">matched_concepts_observation</span><span class="op">$</span><span class="va">concept_name</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"glm_table$"</span>, <span class="fu">custom_make_names</span><span class="op">(</span><span class="va">matched_concepts_conditions</span><span class="op">$</span><span class="va">concept_name</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    collapse <span class="op">=</span> <span class="st">" + "</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the GLM</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.glm.html" class="external-link">ds.glm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">formula</span>, </span>
<span>  data <span class="op">=</span> <span class="st">"glm_table"</span>, </span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $Nvalid</span></span>
<span><span class="co">## [1] 576750</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Nmissing</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Ntotal</span></span>
<span><span class="co">## [1] 576750</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $disclosure.risk</span></span>
<span><span class="co">##         RISK OF DISCLOSURE</span></span>
<span><span class="co">## server1                  0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $errorMessage</span></span>
<span><span class="co">##         ERROR MESSAGES</span></span>
<span><span class="co">## server1 "No errors"   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $nsubs</span></span>
<span><span class="co">## [1] 576750</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $iter</span></span>
<span><span class="co">## [1] 10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $family</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Family: binomial </span></span>
<span><span class="co">## Link function: logit </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $formula</span></span>
<span><span class="co">## [1] "glm_table$chronic_obstructive_pulmonary_disease ~ glm_table$tobacco_user +      glm_table$rheumatoid_arthritis + glm_table$asthma + glm_table$vitamin_d_deficiency"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $coefficients</span></span>
<span><span class="co">##                                 Estimate Std. Error     z-value</span></span>
<span><span class="co">## (Intercept)                    -6.572083 0.03534378 -185.947355</span></span>
<span><span class="co">## glm_table$tobacco_user          1.860760 0.24413811    7.621753</span></span>
<span><span class="co">## glm_table$rheumatoid_arthritis  2.106862 0.39986610    5.268918</span></span>
<span><span class="co">## glm_table$asthma                2.996876 0.11485691   26.092255</span></span>
<span><span class="co">## glm_table$vitamin_d_deficiency  1.814804 0.30800707    5.892084</span></span>
<span><span class="co">##                                      p-value low0.95CI.LP high0.95CI.LP</span></span>
<span><span class="co">## (Intercept)                     0.000000e+00    -6.641355     -6.502810</span></span>
<span><span class="co">## glm_table$tobacco_user          2.502536e-14     1.382258      2.339262</span></span>
<span><span class="co">## glm_table$rheumatoid_arthritis  1.372299e-07     1.323139      2.890585</span></span>
<span><span class="co">## glm_table$asthma               4.463685e-150     2.771760      3.221991</span></span>
<span><span class="co">## glm_table$vitamin_d_deficiency  3.813549e-09     1.211121      2.418486</span></span>
<span><span class="co">##                                        P_OR low0.95CI.P_OR</span></span>
<span><span class="co">## (Intercept)                     0.001396927    0.001303556</span></span>
<span><span class="co">## glm_table$tobacco_user          6.428622994    3.983888931</span></span>
<span><span class="co">## glm_table$rheumatoid_arthritis  8.222397606    3.755189296</span></span>
<span><span class="co">## glm_table$asthma               20.022883190   15.986751946</span></span>
<span><span class="co">## glm_table$vitamin_d_deficiency  6.139869864    3.357245312</span></span>
<span><span class="co">##                                high0.95CI.P_OR</span></span>
<span><span class="co">## (Intercept)                        0.001496976</span></span>
<span><span class="co">## glm_table$tobacco_user            10.373580768</span></span>
<span><span class="co">## glm_table$rheumatoid_arthritis    18.003838708</span></span>
<span><span class="co">## glm_table$asthma                  25.078005376</span></span>
<span><span class="co">## glm_table$vitamin_d_deficiency    11.228849381</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $dev</span></span>
<span><span class="co">## [1] 13173.98</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $df</span></span>
<span><span class="co">## [1] 576745</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $output.information</span></span>
<span><span class="co">## [1] "SEE TOP OF OUTPUT FOR INFORMATION ON MISSING DATA AND ERROR MESSAGES"</span></span></code></pre>
<p>In the next chapter, we will provide a template for creating these
analysis for other conditions and predictors. This will allow you to
easily adapt the analysis to your specific needs, for any OMOP CDM
database.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/davidsarratgonzalez" class="external-link">David Sarrat González</a>, <a href="https://github.com/ESCRI11" class="external-link">Xavier Escribà-Montagut</a>, <a href="https://github.com/isglobal-brge" class="external-link">Juan R González</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

  </div></footer>
</body>
</html>
